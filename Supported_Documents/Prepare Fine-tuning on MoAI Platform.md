


# Prepare Fine-tuning on MoAI Platform

MoAI Platformμ€ λ‹¤μ–‘ν• GPUλ΅ κµ¬μ„±λ  μ μμ§€λ§, λ™μΌν• μΈν„°νμ΄μ¤(CLI)λ¥Ό ν†µν•΄ μ‚¬μ©μμ—κ² μΌκ΄€λ κ²½ν—μ„ μ κ³µν•©λ‹λ‹¤. λ¨λ“  μ‚¬μ©μκ°€ κ°™μ€ λ°©μ‹μΌλ΅ μ‹μ¤ν…μ— μ ‘κ·Όν•μ—¬ ν”λ«νΌμ„ μ‚¬μ©ν•  μ μκΈ° λ•λ¬Έμ— λ³΄λ‹¤ ν¨μ¨μ μ΄λ©° μ§κ΄€μ μ…λ‹λ‹¤.

MoAI Platform λν• μΌλ°μ μΈ AI ν•™μµ ν™κ²½κ³Ό μ μ‚¬ν•κ²  Python κΈ°λ°μ ν”„λ΅κ·Έλλ°μ„ μ§€μ›ν•©λ‹λ‹¤. μ΄μ— λ”°λΌ λ³Έ λ¬Έμ„μ—μ„λ” AI ν•™μµμ„ μ„ν• ν‘μ¤€ ν™κ²½ κµ¬μ„±μΌλ΅μ„ conda κ°€μƒ ν™κ²½μ μ„¤μ •κ³Ό μ‚¬μ© λ°©λ²•μ„ μ¤‘μ‹¬μΌλ΅ μ„¤λ…ν•©λ‹λ‹¤.

## conda ν™κ²½ μ„¤μ •ν•κΈ°

1. ν›λ ¨μ„ μ‹μ‘ν•κΈ° μ„ν•΄ λ¨Όμ € conda ν™κ²½μ„ μƒμ„±ν•©λ‹λ‹¤.
    
    ```bash
    $ conda create --name <my-env> python=3.8
    ```
    
    `<my-env>` μ—λ” μ‚¬μ©μκ°€ μ‚¬μ©ν•  ν™κ²½ μ΄λ¦„μ„ μ…λ ¥ν•©λ‹λ‹¤.
    
2. conda ν™κ²½μ„ ν™μ„±ν™”ν•©λ‹λ‹¤.
    
    ```bash
    $ conda activate <my-env>
    ```
    
3. Fine-tuningμ— ν•„μ”ν• libraryμ™€ packageλ¥Ό μ„¤μΉν•©λ‹λ‹¤.
    
    ```bash
    $ pip install torch==1.13.1+cu116.moreh24.3.0
    $ pip install transformers==4.34.0
    $ pip install datasets==2.14.5
    $ pip install loguru==0.7.2
    ```
    
4. `moreh-smi` λ…λ Ήμ–΄λ¥Ό μ…λ ¥ν•΄ μ„¤μΉλ Moreh μ†”λ£¨μ…μ λ²„μ „κ³Ό μ‚¬μ©μ¤‘μΈ MoAI Accelerator μ •λ³΄λ¥Ό ν™•μΈν•  μ μμµλ‹λ‹¤. ν„μ¬ μ‚¬μ©μ¤‘μΈ MoAI Acceleratorλ” `4xLarge.2048GB`μ…λ‹λ‹¤. MoAI Acceleratorμ— λ€ν• μμ„Έν• μ •λ³΄λ” MoAI Accelerator μ‚¬μ–‘μ„ μ°Έκ³ ν•΄μ£Όμ„Έμ”.
    
    ```bash
    $ moreh-smi
    11:07:03 April 01, 2024
    +-----------------------------------------------------------------------------------------------------+
    |                                                    Current Version: 24.3.0  Latest Version: 24.3.0  |
    +-----------------------------------------------------------------------------------------------------+
    |  Device  |        Name         |       Model      |  Memory Usage  |  Total Memory  |  Utilization  |
    +=====================================================================================================+
    |  * 0     |   MoAI Accelerator  |  4xLarge.2048GB  |  -             |  -             |  -            |
    +-----------------------------------------------------------------------------------------------------+
    ```
    

# MoAI Accelerator μ„ νƒ, λ³€κ²½ν•κΈ°

sLLM νμΈνλ‹μ‹ ν•™μµ λ°μ΄ν„° λ°°μΉ μ‚¬μ΄μ¦μ— λ”°λ¥Έ μ μ ν• MoAI Accelerator λ¨λΈμ„ moreh toolkitμ„ μ‚¬μ©ν•μ—¬ μ„ νƒ, λ³€κ²½ν•  μ μμµλ‹λ‹¤. μ°Έκ³ λ΅, sLLM(μ•½ 7B~13B λ¨λΈ)μ„ fine-tuning ν•κΈ° μ„ν•΄ μΌλ°μ μΌλ΅ μ‚¬μ©λλ” λ°μ΄ν„°μ…‹μ ν¬κΈ°λ” μ•½ 40GBμ ν…μ¤νΈ λ°μ΄ν„°μ…‹μ…λ‹λ‹¤. 

λ¨Όμ €, `moreh-smi` λ¥Ό μ‚¬μ©ν•μ—¬ ν„μ¬ μ‚¬μ©ν•κ³  μλ” MoAI Accelerator λ¨λΈμ„ ν™•μΈν•΄ λ³΄κ² μµλ‹λ‹¤. 

```bash
$ moreh-smi
12:01:30 April 12, 2024
+------------------------------------------------------------------------------------------------+
|                                                     Current Version:   Latest Version: 24.2.0  |
+------------------------------------------------------------------------------------------------+
|  Device  |    Name            |     Model    |  Memory Usage  |  Total Memory  |  Utilization  |
+================================================================================================+
|  * 0     |  MoAI Accelerator  |  Small.64GB  |  -             |  -             |  -            |
+------------------------------------------------------------------------------------------------+
```

ν„μ¬  μ‚¬μ©ν•κ³  μλ” MoAI Accelerator λ¨λΈμ—μ„ μ κ³µλλ” λ©”λ¨λ¦¬λ” 64GBμ…λ‹λ‹¤.  `moreh-switch-model` μ„ μ‚¬μ©ν•μ—¬ λ” ν° λ©”λ¨λ¦¬λ¥Ό μ κ³µν•λ” MoAI Accelerator λ¨λΈλ΅ λ³€κ²½ν•΄ λ³΄κ² μµλ‹λ‹¤. 

```bash
$ moreh-switch-model
Current MoAI Accelerator: Small.64GB

1. Small.64GB  *
2. Medium.128GB
3. Large.256GB
4. xLarge.512GB
5. 1.5xLarge.768GB
6. 2xLarge.1024GB
7. 3xLarge.1536GB
8. 4xLarge.2048GB
9. 6xLarge.3072GB
10. 8xLarge.4096GB
11. 12xLarge.6144GB
12. 24xLarge.12288GB
13. 48xLarge.24576GB

Selection (1-13, q, Q):
```

`4xLarge.2048GB` λ¨λΈλ΅ λ³€κ²½ν•κΈ° μ„ν•΄ `8`μ„ μ…λ ¥ν•©λ‹λ‹¤. 

```bash
Selection (1-13, q, Q): 8
The MoAI Accelerator model is successfully switched to  "4xLarge.2048GB".

1. Small.64GB
2. Medium.128GB
3. Large.256GB
4. xLarge.512GB
5. 1.5xLarge.768GB
6. 2xLarge.1024GB
7. 3xLarge.1536GB
8. 4xLarge.2048GB  *
9. 6xLarge.3072GB
10. 8xLarge.4096GB
11. 12xLarge.6144GB
12. 24xLarge.12288GB
13. 48xLarge.24576GB

Selection (1-13, q, Q): q
```

 `q` λ¥Ό μ…λ ¥ν•μ—¬ λ³€κ²½μ„ μ™„λ£ν•©λ‹λ‹¤. 

λ‹¤μ‹ `moreh-smi` λ¥Ό μ‚¬μ©ν•μ—¬ λ³€κ²½λ μƒνƒλ¥Ό ν™•μΈν•λ©΄ μ‚¬μ©ν•κ³  μλ” MoAI Accelerator λ¨λΈμ΄ `4xLarge.2048GB` λ¨λΈλ΅ λ³€κ²½λ κ²ƒμ„ ν™•μΈν•  μ μμµλ‹λ‹¤. 

```bash
$ moreh-smi
12:02:19 April 12, 2024
+----------------------------------------------------------------------------------------------------+
|                                                         Current Version:   Latest Version: 24.2.0  |
+----------------------------------------------------------------------------------------------------+
|  Device  |    Name            |     Model        |  Memory Usage  |  Total Memory  |  Utilization  |
+====================================================================================================+
|  * 0     |  MoAI Accelerator  |  4xLarge.2048GB  |  -             |  -             |  -            |
+----------------------------------------------------------------------------------------------------+
```

<aside>
π’΅ κ° λ¨λΈλ³„λ΅ MoAI Platformμ—μ„ κ¶μ¥ν•λ” Fine-tuning μ‹ μµμ μ νλΌλ―Έν„°λ” [LLM Fine-tuning νλΌλ―Έν„° κ°€μ΄λ“](LLM%20Fine-tuning%20νλΌλ―Έν„°%20κ°€μ΄λ“.md) λ¥Ό μ°Έκ³ ν•μ‹κΈ° λ°”λλ‹λ‹¤.

</aside>

<aside>
π’΅ `moreh-smi` , `moreh-switch-mode` λ¥Ό λΉ„λ΅―ν• moreh toolkitμ κµ¬μ²΄μ μΈ μ‚¬μ© λ°©λ²•μ— λ€ν•΄μ„λ” [MoAI Platformμ toolkit μ‚¬μ©ν•κΈ°](//) λ¥Ό μ°Έκ³ ν•μ‹κΈ° λ°”λλ‹λ‹¤.

</aside>